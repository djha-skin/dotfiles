#!/bin/sh
set -ex
if [ -f ~/.profile ]
then
    . ~/.profile
elif [ -f ~/.zprofile ]
then
    . ~/.zprofile
fi

echo "${@}" > ~/.screen2rclone.log

raw=false
viewport=false
remote=OneDrive
while [ -n "${1}" ]
do
    case "${1}" in
        --raw)
            raw=true
            shift
            ;;
        --view)
            viewport=true
            shift
            ;;
        --remote)
            shift
            remote="${1}"
            shift
            ;;
        *)
            echo "Nope." >&2
            exit 1
    esac
done

itis=$(date '+%Y-%m-%d-%H-%M-%S')
fname="${itis}.png"
src="${HOME:-/home/danielhaskin}/Pictures/Screenshots"
dest="${remote}:Screenshots"

#echo "startup"
#mkdir -p "${src}"
#rclone mkdir "${dest}"

echo "screenshot"  >> ~/.screen2rclone.log 2>&1
screenshot-region "${src}/${fname}"  >> ~/.screen2rclone.log 2>&1
echo "copy"  >> ~/.screen2rclone.log 2>&1
rclone copyto "${src}/${fname}" "${dest}/${fname}"  >> ~/.screen2rclone.log 2>&1
echo "clipboard"  >> ~/.screen2rclone.log 2>&1
raw_link=$(rclone link --expire 100y "${dest}/${fname}")
printf "${raw_link}" | copy >/dev/null 2>/dev/null
notify "screen2rclone" "Synced to ${remote}, URL in clipboard"  >> ~/.screen2rclone.log 2>&1
